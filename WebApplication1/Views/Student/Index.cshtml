@model IEnumerable<WebApplication1.Models.Student>

@{
    ViewData["Title"] = "Student List";
}

<div class="student-list-container">
    <!-- Header Section with Search -->
    <div class="list-header">
        <div class="header-left">
            <div class="icon-badge">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="page-title">Student List</h1>
        </div>
        <div class="header-right">
            <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" class="search-field" placeholder="Search students..." />
            </div>
        </div>
    </div>

    <!-- Table Section -->
    <div class="data-table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Course</th>
                    <th>Email</th>
                    @if (User.IsInRole("Admin"))
                    {
                        <th>Actions</th>
                    }
                </tr>
            </thead>
            <tbody id="studentTableBody">
                @foreach (var item in Model) {
                    <tr class="data-row">
                        <td>@Html.DisplayFor(modelItem => item.Id)</td>
                        <td>@Html.DisplayFor(modelItem => item.Firstname)</td>
                        <td>@Html.DisplayFor(modelItem => item.Lastname)</td>
                        <td><span class="course-badge">@Html.DisplayFor(modelItem => item.Course)</span></td>
                        <td>@Html.DisplayFor(modelItem => item.Email)</td>
                        @if (User.IsInRole("Admin"))
                        {
                            <td>
                                <div class="action-btns">
                                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn-edit" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn-delete" title="Delete" onclick="return confirm('Are you sure you want to delete this student?')">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </div>
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Footer with Pagination and Back -->
    <div class="list-footer">
        <div class="footer-left">
            <a asp-controller="Home" asp-action="Index" class="back-link">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
        <div class="footer-right">
            <nav class="pagination-nav" id="studentPaginationList">
                <button id="studentPrev" class="page-btn" type="button">&laquo;</button>
                <!-- Page numbers inserted by JS -->
                <button id="studentNext" class="page-btn" type="button">&raquo;</button>
            </nav>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Student list script loaded');
            
            const searchInput = document.getElementById('searchInput');
            const tbody = document.getElementById('studentTableBody');
            const paginationNav = document.getElementById('studentPaginationList');
            const prevBtn = document.getElementById('studentPrev');
            const nextBtn = document.getElementById('studentNext');
            
            console.log('Search input:', searchInput);
            console.log('Table body:', tbody);
            console.log('Pagination:', paginationNav);
            
            const rowsPerPage = 5;
            let currentPage = 1;
            let allRows = [];
            let filteredRows = [];

            function initialize() {
                if (!tbody) {
                    console.error('Table body not found');
                    return;
                }
                allRows = Array.from(tbody.querySelectorAll('tr.data-row'));
                console.log('Total rows:', allRows.length);
                filteredRows = [...allRows];
                renderPage();
            }

            function filterRows() {
                const searchText = searchInput.value.toLowerCase().trim();
                console.log('Filtering with:', searchText);
                
                if (!searchText) {
                    filteredRows = [...allRows];
                } else {
                    filteredRows = allRows.filter(row => {
                        const text = row.textContent.toLowerCase();
                        return text.includes(searchText);
                    });
                }
                console.log('Filtered rows:', filteredRows.length);
                currentPage = 1;
                renderPage();
            }

            function renderPage() {
                if (!tbody || filteredRows.length === 0) {
                    if (allRows.length > 0) {
                        allRows.forEach(row => row.style.display = 'none');
                    }
                    updatePagination(0);
                    return;
                }

                const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
                if (currentPage > totalPages) currentPage = totalPages;
                if (currentPage < 1) currentPage = 1;

                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;
                const pageRows = filteredRows.slice(start, end);

                console.log('Rendering page', currentPage, 'showing rows', start, 'to', end);

                // Hide all rows first
                allRows.forEach(row => {
                    row.style.display = 'none';
                });

                // Show current page rows
                pageRows.forEach(row => {
                    row.style.display = 'table-row';
                    row.style.opacity = '1';
                });

                updatePagination(totalPages);
            }

            function updatePagination(totalPages) {
                if (!paginationNav) return;

                // Show/hide pagination
                if (totalPages <= 1) {
                    paginationNav.style.display = 'none';
                    return;
                } else {
                    paginationNav.style.display = 'flex';
                }

                // Update prev/next buttons
                if (prevBtn) {
                    prevBtn.disabled = currentPage <= 1;
                }
                if (nextBtn) {
                    nextBtn.disabled = currentPage >= totalPages;
                }

                // Remove old page number buttons
                const oldPageBtns = paginationNav.querySelectorAll('.page-btn[data-page]');
                oldPageBtns.forEach(btn => btn.remove());

                // Create new page number buttons
                for (let i = 1; i <= totalPages; i++) {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                    btn.textContent = i;
                    btn.dataset.page = i;
                    btn.addEventListener('click', function() {
                        currentPage = parseInt(this.dataset.page);
                        renderPage();
                    });

                    // Insert before next button
                    if (nextBtn) {
                        paginationNav.insertBefore(btn, nextBtn);
                    } else {
                        paginationNav.appendChild(btn);
                    }
                }
            }

            // Event listeners
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    console.log('Search input changed');
                    filterRows();
                });
                console.log('Search listener attached');
            } else {
                console.error('Search input not found');
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', function() {
                    if (currentPage > 1) {
                        currentPage--;
                        renderPage();
                    }
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
                    if (currentPage < totalPages) {
                        currentPage++;
                        renderPage();
                    }
                });
            }

            // Initialize
            initialize();
        });
    </script>
}

<style>
    .student-list-container {
        padding: 2rem;
        background: linear-gradient(to bottom, #1e3c72 0%, #2a5298 100%);
        min-height: 100vh;
    }

    /* Header Section */
    .list-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 1.5rem 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .icon-badge {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .page-title {
        margin: 0;
        color: #1e3c72;
        font-size: 1.8rem;
        font-weight: 700;
    }

    .header-right {
        flex: 0 0 400px;
    }

    .search-wrapper {
        position: relative;
    }

    .search-wrapper i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #1e3c72;
    }

    .search-field {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: border-color 0.2s;
    }

    .search-field:focus {
        outline: none;
        border-color: #1e3c72;
    }

    /* Table Section */
    .data-table-wrapper {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table thead {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
    }

    .data-table th {
        padding: 1rem 1.5rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .data-table td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #f1f5f9;
        color: #334155;
        font-size: 0.95rem;
    }

    .data-row {
        transition: background-color 0.15s ease;
    }

    .data-row:hover {
        background-color: #f8fafc;
    }

    .course-badge {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        background: #dce8ff;
        color: #1e3c72;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    /* Action Buttons */
    .action-btns {
        display: flex;
        gap: 0.5rem;
    }

    .btn-edit,
    .btn-delete {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        text-decoration: none;
        transition: all 0.2s;
    }

    .btn-edit {
        background: #dce8ff;
        color: #1e3c72;
    }

    .btn-edit:hover {
        background: #1e3c72;
        color: white;
    }

    .btn-delete {
        background: #fee2e2;
        color: #dc2626;
    }

    .btn-delete:hover {
        background: #dc2626;
        color: white;
    }

    /* Footer Section */
    .list-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 1rem 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.6rem 1.2rem;
        background: #f1f5f9;
        color: #334155;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
    }

    .back-link:hover {
        background: #1e3c72;
        color: white;
    }

    /* Pagination */
    .pagination-nav {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .page-btn {
        min-width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #e2e8f0;
        background: white;
        color: #334155;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        padding: 0 0.75rem;
    }

    .page-btn:hover:not(:disabled) {
        background: #1e3c72;
        color: white;
        border-color: #1e3c72;
    }

    .page-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    .page-btn.active {
        background: #1e3c72;
        color: white;
        border-color: #1e3c72;
    }

    @@media (max-width: 768px) {
        .list-header {
            flex-direction: column;
            gap: 1rem;
        }

        .header-right {
            flex: 1;
            width: 100%;
        }

        .list-footer {
            flex-direction: column;
            gap: 1rem;
        }

        .data-table {
            font-size: 0.85rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem 0.5rem;
        }
    }
</style>

